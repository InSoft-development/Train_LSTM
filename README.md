

# Запуск

Чтобы запустить скрипт, выполните следующие шаги:

1. Установите необходимые пакеты: `numpy`,` pandas`, `tensorflow`,` joblib`, `clickhouse_driver`

```bash
pip install -r requirements.txt
```

   2.Для запуска кода выполните следующую команду:

`	python train.py --station <station_name>`


## Описание

Код выполняет следующие задачи:

1. Импортирует необходимые библиотеки:
   * seaborn
   * matplotlib.pyplot
   * pandas
   * sqlite3
   * os
   * numpy
   * argparse
   * shutil
   * tensorflow
   * keras.optimizers.adam
   * utils.data (пользовательский модуль)
   * utils.smooth (пользовательский модуль)
   * model (пользовательский модуль)
2. Определяет функцию `get_len_size(LAG, x_size)`, которая вычисляет длину обучающих данных на основе размера лага.
3. Настраивает парсер аргументов для приема аргументов командной строки.
4. Загружает файл конфигурации на основе указанного аргумента командной строки.
5. Устанавливает различные переменные конфигурации на основе загруженного файла конфигурации.
6. Проверяет, выбран источник данных CSV или SQL и загружает данные соответственно.
7. Настраивает TensorFlow для использования графических процессоров (GPU) и включения динамического выделения памяти.
8. Выполняет предварительную обработку данных на основе конфигурации:
   * Заполняет отсутствующие значения средним значением столбца, если включена опция `MEAN_NAN`.
   * Удаляет строки с отсутствующими значениями, если включена опция `DROP_NAN`.
   * Вычисляет скользящее среднее, если включена опция `ROLLING_MEAN`.
   * Применяет экспоненциальное сглаживание, если включена опция `EXP_SMOOTH`.
   * Применяет двойное экспоненциальное сглаживание, если включена опция `DOUBLE_EXP_SMOOTH`.
9. Загружает информацию о группах из CSV-файла.
10. Проходит по группам и выполняет следующие действия для каждой группы:
    * Фильтрует фрейм данных на основе значений KKS группы.
    * Масштабирует данные группы с помощью пользовательской функции `get_scaled()`.
    * Сохраняет объект масштабирования для группы.
11. Создает необходимые каталоги для сохранения модели и информации об обучении.
12. Копирует файл конфигурации в каталог с информацией об обучении.
13. Проходит по списку групповых данных и обучает модель автокодировщика для каждой группы:
    * Определяет архитектуру модели с помощью пользовательской функции `autoencoder_model()`.
    * Компилирует модель с оптимизатором Adam и функцией потерь средней абсолютной ошибки.
    * Настраивает обратные вызовы для ранней остановки, сохранения лучшей модели и снижения скорости обучения.
    * Обучает модель с использованием данных группы и сохраняет лучшую модель на основе потери на валидации.
    * Сохраняет сводку модели в текстовый файл.

## Результат

Код генерирует следующие результаты:

* Обученные модели автокодировщика для каждой группы, сохраненные в виде файлов `lstm_group_<i>.h5` в указанном каталоге.
* Сводки моделей для каждой группы, сохраненные в виде файлов `modelsummary_<i>.txt` в указанном каталоге.

Кроме того, код создает каталоги для сохранения информации об обучении и копирует файл конфигурации в соответствующий каталог.
